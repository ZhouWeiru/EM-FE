{"version":3,"file":null,"sources":["../src/log.js","../src/index.js"],"sourcesContent":["export function log (text) {\r\n  console.log(text)\r\n}\r\n\r\nexport function warn (text) {\r\n  console.log(red(text))\r\n}\r\n\r\nexport function emitted (text, bytes) {\r\n  console.log(green(text), getSize(bytes))\r\n}\r\n\r\nexport function green (text) {\r\n  return '\\u001b[1m\\u001b[32m' + text + '\\u001b[39m\\u001b[22m'\r\n}\r\n\r\nexport function red (text) {\r\n  return '\\u001b[1m\\u001b[31m' + text + '\\u001b[39m\\u001b[22m'\r\n}\r\n\r\nexport function getSize (bytes) {\r\n  return bytes < 10000\r\n    ? bytes.toFixed(0) + ' B'\r\n    : bytes < 1024000\r\n    ? (bytes / 1024).toPrecision(3) + ' kB'\r\n    : (bytes / 1024 / 1024).toPrecision(4) + ' MB'\r\n}\r\n","import { createFilter } from 'rollup-pluginutils'\r\nimport parse5 from 'parse5'\r\nimport compiler from 'vue-template-compiler'\r\nimport MagicString from 'magic-string'\r\n\r\nimport { log, warn } from './log.js'\r\n\r\nexport default function vue2 (options = {}) {\r\n  const filter = createFilter(options.include, options.exclude)\r\n  const styles = {}\r\n\r\n  return {\r\n    name: 'vue2',\r\n    options (options) {\r\n      options.useStrict = false\r\n      return options\r\n    },\r\n    resolveId (id) {\r\n      if (id.indexOf('.vue.component.') !== -1) {\r\n        return id\r\n      }\r\n    },\r\n    load (id) {\r\n      if (id.indexOf('.vue.component.') !== -1) {\r\n        id = id.slice(0, id.lastIndexOf('.vue.component.') + 4)\r\n        return styles[id] || ''\r\n      }\r\n    },\r\n    transform (code, id) {\r\n      if (!filter(id) || !id.endsWith('.vue')) {\r\n        return\r\n      }\r\n\r\n      const { js, css } = vueTransform(code, id)\r\n\r\n      // Map of every stylesheet\r\n      styles[id] = css\r\n\r\n      // Replace \"with(this){\" with something that works in strict mode\r\n      // https://github.com/vuejs/vue-template-es2015-compiler/blob/master/index.js\r\n      return js.replace(/with\\(this\\)/g, 'if(window.__VUE_WITH__)')\r\n    },\r\n    transformBundle (code) {\r\n      return code\r\n        .replace(/process\\.env\\.VUE_ENV/g, JSON.stringify(process.env.VUE_ENV || ''))\r\n        .replace(/process\\.env\\.NODE_ENV/g, JSON.stringify(process.env.NODE_ENV || ''))\r\n    },\r\n    ongenerate (opts, rendered) {\r\n      // Revert \"with(this){\"\r\n      rendered.code = rendered.code.replace(/if\\s*\\(window.__VUE_WITH__\\)/g, 'with(this)')\r\n    }\r\n  }\r\n}\r\n\r\nfunction vueTransform (code, id) {\r\n  const s = MagicString(code)\r\n\r\n  // Parse the file into an HTML tree and \r\n  const nodes = getNodes(code)\r\n\r\n  // Process script\r\n  var js\r\n  if (nodes.script) {\r\n    js = parse5.serialize(nodes.script)\r\n  } else {\r\n    js = 'export default {\\n}'\r\n  }\r\n\r\n  // Precompile and inject Vue template\r\n  if (nodes.template && nodes.template.content) {\r\n    let template = parse5.serialize(nodes.template.content)\r\n    template = template.replace(/&amp;&amp;/g, '&&')\r\n    js = injectTemplate(js, template)\r\n    if (template.errors) {\r\n      log(id)\r\n      template.errors.forEach(warn)\r\n    }\r\n  }\r\n\r\n  // Import css as a module\r\n  // Example: import \"./src/App.vue.component.css\"\r\n  var css\r\n  if (nodes.style) {\r\n    let lang = checkLang(nodes.style) || 'css'\r\n    js = 'import ' + JSON.stringify(id + '.component.' + lang) + '\\n' + js\r\n    css = parse5.serialize(nodes.style)\r\n  }\r\n\r\n  return { js, css }\r\n}\r\n\r\nfunction toNodes (code) {\r\n  const fragment = parse5.parseFragment(code)\r\n\r\n  // Walk through the top level nodes and check for their types\r\n  const nodes = {}\r\n  for (let i = fragment.childNodes.length - 1; i >= 0; i--) {\r\n    nodes[fragment.childNodes[i].nodeName] = fragment.childNodes[i]\r\n  }\r\n\r\n  return nodes\r\n}\r\n\r\n\r\n/**\r\n * Wrap a piece of code in a function\r\n *\r\n * @param {String} code\r\n * @return {String}\r\n */\r\nfunction toFunction (code) {\r\n  return 'function(){' + code + '}'\r\n}\r\n\r\n/**\r\n * Only support for es5 modules\r\n *\r\n * @param script\r\n * @param template\r\n * @returns {string}\r\n */\r\nfunction injectTemplate (script, template) {\r\n  // Compile template\r\n  const compiled = compiler.compile(template)\r\n  const moduleFuncs = '\\nrender: ' + toFunction(compiled.render) + ',' +\r\n    '\\nstaticRenderFns: [' + compiled.staticRenderFns.map(toFunction).join(',') + ']'\r\n\r\n  // There is no script tag\r\n  if (!script || script.length < 20) {\r\n    return 'export default {' + moduleFuncs + '\\n}'\r\n  }\r\n\r\n  // Inject in actual script\r\n  const matches = /(export default[^{]*\\{)/g.exec(script)\r\n  if (!matches) {\r\n    throw new Error('[rollup-plugin-vue2] could not find place to inject template in script.')\r\n  }\r\n  return script.split(matches[1]).join(matches[1] + moduleFuncs + ',')\r\n}\r\n\r\n/**\r\n * Check the lang attribute of a parse5 node.\r\n *\r\n * @param {Node} node\r\n * @return {String|undefined}\r\n */\r\nfunction checkLang (node) {\r\n  if (node.attrs) {\r\n    let i = node.attrs.length\r\n    while (i--) {\r\n      const attr = node.attrs[i]\r\n      if (attr.name === 'lang') {\r\n        return attr.value\r\n      }\r\n    }\r\n  }\r\n  return undefined\r\n}\r\n"],"names":["const","createFilter","let"],"mappings":"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"}